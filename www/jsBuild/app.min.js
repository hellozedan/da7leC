!function(){angular.module("starter",["ionic","starter.controllers","starter.services","angularMoment","ngCordova","firebase","ui.identicon","toastr"]).run(["$ionicPlatform","$state","ConfigurationService","UserService","EntityService","$timeout",function(e,t,o,n,r,s){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(setTimeout(function(){navigator.splashscreen.hide()},50),cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault();if(window.cordova&&"undefined"!=typeof window.plugins.OneSignal&&!o.Notification_token()){console.log("in 1");var e=function(e){var t=JSON.parse(e.notification.payload.additionalData);console.log("in 2"),alert("Notification received:\n"+JSON.stringify(t)),console.log("didReceiveRemoteNotificationCallBack: "+JSON.stringify(e))};window.plugins.OneSignal.startInit("f4348bab-6374-4533-9781-75bb7041baf3","510262335541").handleNotificationOpened(e).endInit()}var r=o.UserDetails();r?n.CheckUser().then(function(e){e.isNeedLogin===!1?o.getContactList().then(function(e){t.go("friends")},function(){t.go("friends")}):t.go("login")},function(e){t.go("login")}):t.go("login")})}]).factory("focus",["$timeout","$window",function(e,t){return function(o){e(function(){var e=t.document.getElementById(o);e&&e.focus()})}}]).directive("eventFocus",["focus",function(e){return function(t,o,n){o.on(n.eventFocus,function(){e(n.eventFocusId)}),t.$on("$destroy",function(){element.off(n.eventFocus)})}}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("tab",{url:"/tab",abstract:!0,templateUrl:"templates/tabs/html/tabs.html"}).state("login",{url:"/login",templateUrl:"templates/login/html/login.html",controller:"loginCtrl"}).state("chat",{url:"/chat",templateUrl:"templates/chat/html/chat.html",controller:"chatCtrl"}).state("userProfile",{url:"/userProfile/:userId/:first_name",templateUrl:"templates/profile/html/userProfile.html",controller:"userProfileCtrl"}).state("blockedUsers",{url:"/blockedUsers",templateUrl:"templates/blockedUsers/html/blockedUsers.html",controller:"blockedUsersCtrl"}).state("tab.subjects",{url:"/subjects",views:{"tab-subjects":{templateUrl:"templates/match/html/subjects.html",controller:"subjectsCtrl"}}}).state("tab.match",{url:"/match",views:{"tab-match":{templateUrl:"templates/match/html/match.html",controller:"matchCtrl"}}}).state("tab.messages",{url:"/messages",views:{"tab-messages":{templateUrl:"templates/messages/html/messages.html",controller:"messagesCtrl"}}}).state("friends",{url:"/friends",templateUrl:"templates/friends/html/friends.html",controller:"friendsCtrl"}).state("invite",{url:"/invite",templateUrl:"templates/invite/html/invite.html",controller:"inviteCtrl"}).state("tab.myProfile",{url:"/myProfile",views:{"tab-myProfile":{templateUrl:"templates/profile/html/myProfile.html",controller:"myProfileCtrl"}}})}])}();var common=new function(){this.indexOfConv=function(e,t){for(var o=0;o<e.length;o++)if(e[o].conversationId===t)return o;return-1}},appControllers=angular.module("starter.controllers",[]),appServices=angular.module("starter.services",[]);appControllers.controller("NewMessagesCtrl",["$scope","MessagesService",function(e,t){e.checkUndreadMessage=function(){return t.checkUndreadMessage()}}]),appControllers.controller("tabsCtrl",["$scope","MessagesService",function(e,t){e.checkUndreadMessage=function(){return t.checkUndreadMessage()}}]),appControllers.controller("AppCtrl",["$scope","$state","$ionicHistory",function(e,t,o){e.goBack=function(){t.current.name.indexOf("chat")>=0?o.backView()?o.goBack():t.go("tab.messages"):o.goBack()}}]),appServices.factory("favoriteService",["$state","$rootScope","$ionicPlatform","$ionicHistory",function(e,t,o,n){var r=[];return{getFavorites:function(){return r.length>0?r:r=angular.fromJson(window.localStorage.favorites)||[]},addToFavorites:function(e){r.push(e),window.localStorage.favorites=angular.toJson(r)}}}]),appServices.factory("backcallFactory",["$state","$rootScope","$ionicPlatform","$ionicHistory","$timeout",function(e,t,o,n,r){var s={};return s.backCall=function(){var s=0;o.registerBackButtonAction(function(){"tab.subjects"===e.current.name||"tab.addSubject-s1"===e.current.name||"tab.messages"===e.current.name||"tab.myProfile"===e.current.name||"login"===e.current.name?0==s?(s++,window.plugins.toast.showShortBottom("press back button again to exit."),r(function(){s=0},3e3)):navigator.app.exitApp():e.current.name.indexOf("chat")>=0?e.go("tab.messages"):null!=n.viewHistory().backView?n.goBack():t.TabName?(e.go(t.TabName),n.clearHistory(),n.clearCache()):e.go("tab.subjects")},100)},s}]),function(){appServices.factory("ChatService",["$q","$timeout","SubjectService","$rootScope","$ionicScrollDelegate","$firebaseObject","$firebaseArray","ConfigurationService","NotificationService","$http","UserService",function(e,t,o,n,r,s,i,a,c,l,u){var f,d,m,p,m,h,v,g,b,S,w,k,$=[],U=a.UserDetails(),y=U.first_name+" "+U.last_name,C=!1,N=function(){r.scrollBottom(!1)};return{getMessages:function(){return $},setMessages:function(e){f=e,m=f.split("-")[0],p=f.split("-")[1],d=U._id+"-"+p,v="https://mustknow.firebaseIO.com/chats/"+m+"/"+d,h="https://mustknow.firebaseIO.com/chats/"+U._id+"/"+f,g=new Firebase("https://mustknow.firebaseIO.com/conversationOnline/"+U._id),b=new Firebase("https://mustknow.firebaseIO.com/conversationOnline/"+m),w=new Firebase(v+"/read"),S=new Firebase(h+"/read"),S.set(!0),g.set({conversationId:e});var t="https://mustknow.firebaseIO.com/chats/"+m+"/blocked/"+U._id,o=new Firebase(t);o.on("value",function(e){C=!!e.val()});var r=new Firebase("https://mustknow.firebaseIO.com/presence/"+m);r.on("value",function(e){e.val()&&"online"==e.val()?n.$broadcast("sendUserOnlineEvent",!0):n.$broadcast("sendUserOnlineEvent",!1)});var s=new Firebase("https://mustknow.firebaseIO.com/chats/"+U._id+"/"+f),a=new Firebase("https://mustknow.firebaseIO.com/chats/"+U._id+"/"+f+"/messages"),c=i(a);c.$loaded(function(e){$=e,n.$broadcast("sendChatEvent","sendChatEvent")}),s.on("value",function(e){k=!1;var t=[];t=e.val().messages;var o=0,n=0,r=0;angular.forEach(t,function(i,a){if(3==o&&o==n&&(k=!0),4==o&&t[a].sender!=U._id&&(k=!1),t[a].sender==U._id?n++:r++,o++,r>=2&&n>=2&&!e.val().userName){var c=e.key().split("-")[0];u.GetUser(c).then(function(e){s.child("userName").set(e.first_name+" "+e.last_name),s.child("fbPhotoUrl").set(e.fbPhotoUrl)},function(e){})}}),N()})},blockUser:function(e){m=f.split("-")[0];var t=new Firebase("https://mustknow.firebaseIO.com/chats/"+U._id+"/blocked/"+m);t.set({userName:e.userName,fbPhotoUrl:e.fbPhotoUrl,userId:m})},sendMessage:function(e,t){if(k)return void a.showAlert();var n,r,i=!1;if(d=U._id+"-"+p,$&&0!=$.length||(i=!0),i){o.Interested(p).then(function(e){},function(e){}),r=new Firebase(v),n=new Firebase(h);var l={userName:y,subjectName:t.subjectName,fbPhotoUrl:U.fbPhotoUrl,desc:t.desc};n.set({userName:t.userName,subjectName:t.subjectName,fbPhotoUrl:t.fbPhotoUrl,read:!0,desc:t.desc}),C&&(l.read=!0),r.set(l),i=!1}r=new Firebase(v+"/messages"),n=new Firebase(h+"/messages");var u=r.push(),f=n.push(),g=new Date,S={body:e,sender:U._id,create_date:g.toJSON(),date_string:g.toLocaleDateString()};if(f.set(S),!C){u.set(S);var N=s(b);N.$loaded(function(e){e?e.conversationId!==d?w.set(!1):w.set(!0):w.set(!1)});var j=new Firebase("https://mustknow.firebaseIO.com/presence/"+m),P=s(j);P.$loaded(function(o){if(o&&"offline"==o.$value){var n={user:m,message:e,conversationId:d,userName:y,subjectName:t.subjectName,fbPhotoUrl:U.fbPhotoUrl,desc:t.desc};c.SendMessage(n).then(function(e){},function(e){})}})}},ReportUser:function(t){var o=e.defer();return l.post(a.ServerUrl()+"/api/users/report",t,{headers:{"access-token":a.UserDetails().token}}).success(function(e){o.resolve(e)}).error(function(e,t){o.reject(e)}),o.promise},scrollBottom:N}}])}(),function(){appServices.factory("ConfigurationService",["$ionicPopup","$q","$cordovaContacts",function(e,t,o){var n={data:""},r={data:""};return{ServerUrl:function(){return"https://da7le.herokuapp.com"},FireBaseUrl:function(){return"https://mustknow.firebaseIO.com"},UserDetails:function(){return this.userDetails||window.localStorage.user&&(this.userDetails=angular.fromJson(window.localStorage.user)),this.userDetails},RefreshUserDetails:function(){return window.localStorage.user&&(this.userDetails=angular.fromJson(window.localStorage.user)),this.userDetails},Notification_token:function(){return this.notification_token||window.localStorage.notification_token&&(this.notification_token=window.localStorage.notification_token),this.notification_token},MyFilter:function(){this.myFilter||window.localStorage.myFilter&&(this.myFilter=angular.fromJson(window.localStorage.myFilter));var e={};return angular.copy(this.myFilter,e),e},SetMyFilter:function(e){e&&(window.localStorage.myFilter=angular.toJson(e),this.myFilter=e)},SetNotification_token:function(e){e&&(window.localStorage.notification_token=angular.toJson(e),this.notification_token=e)},showAlert:function(){var t=e.alert({title:"info",template:"wiat for the other user to answer you"});t.then(function(e){console.log("Thank you for not eating my delicious ice cream cone")})},LogOut:function(){delete this.notification_token,delete this.myFilter,delete this.userDetails},getContacts:function(){var e=t.defer();if(window.cordova)o.find({}).then(function(t){console.log(t.length),console.log(angular.toJson(t[0]),angular.toJson(t[1])),n.data=[],r.data={},t.forEach(function(e){e.displayName&&""!==e.displayName&&e.phoneNumbers&&e.phoneNumbers.length>0&&(n.data.push({phoneNumber:e.phoneNumbers[0].value,name:e.displayName}),r.data[e.phoneNumbers[0].value]={phoneNumber:e.phoneNumbers[0].value,name:e.displayName})}),e.resolve()});else{var s=[{phoneNumbers:[{value:"0528865996"}],displayName:"love"},{phoneNumbers:[{value:"052886www5996"}],displayName:"www"},{phoneNumbers:[{value:"0544282120"}],displayName:"hhhhh"}];n.data=[],r.data={},s.forEach(function(e){e.displayName&&""!==e.displayName&&e.phoneNumbers&&e.phoneNumbers.length>0&&(n.data.push({phoneNumber:e.phoneNumbers[0].value,name:e.displayName}),r.data[e.phoneNumbers[0].value]={phoneNumber:e.phoneNumbers[0].value,name:e.displayName})}),e.resolve()}return e.promise},getContactList:function(){var e=t.defer();return""!==n.data?e.resolve(n.data):this.getContacts().then(function(t){e.resolve(n.data)},function(t){e.reject("err")}),e.promise},getContactObject:function(){var e=t.defer();return""!==n.data?e.resolve(r.data):this.getContacts().then(function(t){e.resolve(r.data)},function(t){e.reject("err")}),e.promise}}}])}(),function(){appServices.factory("EntityService",["ConfigurationService","$q",function(e,t){var o=null,n=null,r=function(e,t){for(var o=0;o<e.length;o++)e[o]._id==t._id&&e.splice(o,1)},s=function(e){o=e},i=function(){return o},a=function(e){n=e},c=function(){return n};return{deleteFromArray:r,setProfile:s,getOtherProfile:i,setMessageDetails:a,getMessageDetails:c}}])}(),function(){appServices.factory("MatchService",["$http","$q","ConfigurationService",function(e,t,o){return{Match:function(n){var r=t.defer();return e.post(o.ServerUrl()+"/api/users/match",n,{headers:{"access-token":o.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},SendMessageToMatcher:function(e){angular.forEach(e.otherPersons,function(t,n){var r=t._id+"-"+e.match_id,s=new Firebase(o.FireBaseUrl()+"/chats/"+e.mainPerson._id+"/"+r+"/messages"),i=new Date,a="hello",c={body:a,sender:t._id,create_date:i.toJSON(),date_string:i.toLocaleDateString()},l=s.push();l.set(c),r=e.mainPerson._id+"-"+e.match_id,s=new Firebase(o.FireBaseUrl()+"/chats/"+t._id+"/"+r+"/messages"),c.sender=e.mainPerson._id,l=s.push(),l.set(c),console.log(t)})}}}])}(),function(){appServices.factory("MessagesService",["$rootScope","$ionicScrollDelegate","$firebaseObject","ConfigurationService",function(e,t,o,n){var r=[],s=n.UserDetails(),i=function(){if(s){var t=new Firebase(n.FireBaseUrl()+"/chats/"+s._id);t.orderByValue().on("value",function(t){r=[],angular.forEach(t.val(),function(t,i){var a=i;if(t.messages){var c=Object.getOwnPropertyNames(t.messages),l=c[c.length-1],u=t.messages[l].body,f=a.split("-")[0],d=!1;t.read&&(d=t.read);var m=common.indexOfConv(r,a),p={conversationId:a,lastMessage:u,lastMessageKey:l,subjectName:t.subjectName,fbPhotoUrl:t.fbPhotoUrl,userName:t.userName,readMessage:d,desc:t.desc};m===-1?r.push(p):r[m]=p;var h=new Firebase(n.FireBaseUrl()+"/presence/"+f);h.on("value",function(t){var i=!0;"offline"==t.val()&&(i=!1);var c=n.FireBaseUrl()+"/chats/"+f+"/blocked/"+s._id,l=new Firebase(c),u=o(l);u.$loaded(function(t){t.userId&&(i=!1);var o=common.indexOfConv(r,a);r[o].online=i,e.$broadcast("sendMessagesEvent","sendMessagesEvent")})})}})})}};return i(),{getMessages:function(){return r},setMessages:function(){i()},checkUndreadMessage:function(){for(var e=0;e<r.length;e++)if(r[e].readMessage===!1)return!0;return!1}}}])}(),function(){appServices.factory("NotificationService",["$http","$log","$q","ConfigurationService",function(e,t,o,n){return{SendMessage:function(t){var r=o.defer();return e.post(n.ServerUrl()+"/api/notification",t,{headers:{"access-token":n.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise}}}])}(),function(){appServices.factory("SubjectService",["$http","$log","$q","ConfigurationService","$cordovaGeolocation",function(e,t,o,n,r){return{TimeToUpdateFromServer:9e5,GetCategories:function(){var t=o.defer();return!n.categories||n.categories.datetime&&(new Date).getTime()-n.categories.datetime.getTime()>this.TimeToUpdateFromServer?e.get(n.ServerUrl()+"/api/subjects/categories",{headers:{"access-token":n.UserDetails().token}}).success(function(e){n.categories={data:e,datetime:new Date},t.resolve(e)}).error(function(e,o){t.reject(e)}):t.resolve(n.categories.data),t.promise},GetSubjects:function(t,s,i){function a(){e.post(n.ServerUrl()+"/api/subjects/filter?userSubjects="+t+"&userId="+i,l,{headers:{"access-token":n.UserDetails().token}}).success(function(e){c.resolve(e)}).error(function(e,t){c.reject(e)})}var c=o.defer();void 0==i&&(i=null);var l=n.MyFilter();if(l.limit=s.limit,l.skip=s.skip,l.gender||(l={nearMe:!1,gender:"both",categories:[]},n.SetMyFilter(l)),l.nearMe){var u={timeout:1e4,enableHighAccuracy:!1};r.getCurrentPosition(u).then(function(e){var t=e.coords.latitude,o=e.coords.longitude;l.locationCoords=[t,o],a()},function(e){l.locationCoords=[],a()})}else l.locationCoords=[],a();return c.promise},GetMySubjects:function(t,r){function s(){e.post(n.ServerUrl()+"/api/subjects/filter?userSubjects=true&status="+r+"&userId="+t,{},{headers:{"access-token":n.UserDetails().token}}).success(function(e){i.resolve(e)}).error(function(e,t){i.reject(e)})}var i=o.defer();return void 0==t&&(t=null),s(),i.promise},Interested:function(t){var r=o.defer();return e.post(n.ServerUrl()+"/api/subjects/interested",{subjectId:t},{headers:{"access-token":n.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},ChangeStatus:function(t,r){var s=o.defer();return e.post(n.ServerUrl()+"/api/subjects/status",{_id:t._id,status:r},{headers:{"access-token":n.UserDetails().token}}).success(function(e){s.resolve(e)}).error(function(e,t){s.reject(e)}),s.promise},CreateSubject:function(t){function s(){e.post(n.ServerUrl()+"/api/subjects",t,{headers:{"access-token":n.UserDetails().token}}).success(function(e){i.resolve(e)}).error(function(e,t){i.reject(e)})}var i=o.defer(),a={timeout:1e4,enableHighAccuracy:!1};return r.getCurrentPosition(a).then(function(e){var o=e.coords.latitude,n=e.coords.longitude;t.locationCoords=[o,n],s()},function(e){t.locationCoords=[],s()}),i.promise},DeleteSubjects:function(t){var r=o.defer();return e.delete(n.ServerUrl()+"/api/subjects?_id="+t._id,{headers:{"access-token":n.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise},UpdateSubject:function(t){var r=o.defer();return e.post(n.ServerUrl()+"/api/subjects",t,{headers:{"access-token":n.UserDetails().token}}).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(e)}),r.promise}}}])}(),function(){appServices.factory("UserService",["$http","$log","$q","$cordovaFacebook","ConfigurationService",function(e,t,o,n,r){var s={};return{AuthPhone:function(t){var n=o.defer();return e.post(r.ServerUrl()+"/api/users",{phone_number:t},{headers:{"Content-Type":"application/json"}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},AuthConfirm:function(t){var n=o.defer();return e.post(r.ServerUrl()+"/api/users/confirm",t,{headers:{"Content-Type":"application/json","access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},AuthFbLogin:function(t){var n=o.defer();return e.post(r.ServerUrl()+"/api/users/facebookLogin",t,{headers:{"Content-Type":"application/json","access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},LogOut:function(){var t=o.defer();return e.get(r.ServerUrl()+"/api/users/logOut",{headers:{"Content-Type":"application/json","access-token":r.UserDetails().token}}).success(function(e){t.resolve(e)}).error(function(e,o){t.reject(e)}),t.promise},GetUser:function(t){var n=o.defer();return e.get(r.ServerUrl()+"/api/users/"+t,{headers:{"access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},CheckUser:function(t){var n=o.defer();return e.get(r.ServerUrl()+"/api/users",{headers:{"access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},GetFriends:function(){var t=o.defer();return e.get(r.ServerUrl()+"/api/users/getFriends",{headers:{"access-token":r.UserDetails().token}}).success(function(e){t.resolve(e)}).error(function(e,o){t.reject(e)}),t.promise},Invite:function(t){var n=o.defer();return e.post(r.ServerUrl()+"/api/users/invite",t,{headers:{"access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},FBlogin:function(){var e=o.defer();return n.login(["public_profile","email","user_friends","user_birthday"]).then(function(t){e.resolve(t)},function(t){alert(JSON.stringify(t)),e.reject(t)}),e.promise},RegisterNotification:function(t){var n=o.defer();return e.post(r.ServerUrl()+"/api/users/notification",{notification_token:t},{headers:{"access-token":r.UserDetails().token}}).success(function(e){n.resolve(e)}).error(function(e,t){n.reject(e)}),n.promise},SetUserProfile:function(e){var t=e.conversationId.split("-")[0];s.userId=t,s.first_name=e.userName,s.fbPhotoUrl=e.fbPhotoUrl},GetUserProfile:function(){return s}}}])}(),function(){appControllers.controller("blockedUsersCtrl",["$scope","$rootScope","$state","$ionicPopup","$stateParams","$filter","$firebaseArray","$mdBottomSheet","$mdDialog","$mdToast","$ionicHistory","SubjectService","ConfigurationService","Firebase",function(e,t,o,n,r,s,i,a,c,l,u,f,d,m){e.isExpanded=!0,t.isHeaderExpanded=!0,e.showConfirm=function(t){var o=n.confirm({title:"Unblock User",template:"Are you sure you want to remove"+t.userName+" from your blocked users?"});o.then(function(o){if(o){var n=new m("https://mustknow.firebaseIO.com/chats/"+e.userDetails._id+"/blocked/"+t.userId);n.remove(),console.log("You are sure")}else console.log("You are not sure")})},e.userDetails=d.UserDetails(),e.initialForm=function(){var t=new m("https://mustknow.firebaseIO.com/chats/"+e.userDetails._id+"/blocked/");e.blockedUsers=i(t)},e.initialForm()}])}(),function(){appControllers.controller("chatCtrl",["$scope","$ionicPopover","$timeout","$ionicScrollDelegate","$rootScope","$state","$ionicPopup","ConfigurationService","ChatService","UserService","EntityService",function(e,t,o,n,r,s,i,a,c,l,u){var f=new Date;e.dateString=f.toLocaleDateString(),e.isExpanded=!0,r.isHeaderExpanded=!0,e.chatDetails=u.getMessageDetails(),e.conversationId=e.chatDetails.conversationId,e.messages=[];var d=e.conversationId.split("-")[0];e.bb=function(){console.log(666)},e.userDetails=a.UserDetails(),c.setMessages(e.conversationId),e.messages=c.getMessages(),o(function(){c.scrollBottom()},100),window.addEventListener("native.keyboardshow",function(){o(function(){n.scrollBottom(!1)},300)}),r.$on("sendChatEvent",function(t,o){e.messages=c.getMessages(),f=new Date,e.dateString=f.toLocaleDateString(),e.$$phase||e.$apply()});var m="https://mustknow.firebaseIO.com/chats/"+e.userDetails._id+"/blocked/"+d,p=new Firebase(m);p.on("value",function(t){t.val()?(e.disableSend=!0,e.sendInputPlaceHolder="this user is blocked"):(e.disableSend=!1,e.sendInputPlaceHolder="Message")}),e.blockUser=function(){var t=i.confirm({title:"Block User",template:"Are you sure you want to block "+e.chatDetails.userName+" ?",buttons:[{text:"Cancel"},{text:"<b>Block</b>",type:"button-positive",onTap:function(e){return"sss"}}]});t.then(function(t){t?(c.blockUser(e.chatDetails),s.go("tab.messages"),e.popover.remove(),console.log("You are sure")):console.log("You are not sure")})},e.reportUser=function(){e.data={is_toBlocked:!0,reason:""};var t=i.show({title:"Report User",template:'<textarea cols="4" ng-model="data.reason" placeholder="Give us more details"></textarea>  <ion-checkbox ng-model="data.is_toBlocked" >Also block this user ? </ion-checkbox>',scope:e,buttons:[{text:"Cancel"},{text:"<b>Report</b>",type:"button-positive",onTap:function(t){return{is_toBlocked:e.data.is_toBlocked,report:{user:e.chatDetails.conversationId.split("-")[1],reason:e.data.reason}}}}]});t.then(function(t){t?(c.ReportUser(t.report),t.is_toBlocked&&c.blockUser(e.chatDetails),s.go("tab.messages"),e.popover.remove(),console.log("You are sure")):console.log("You are not sure")})},e.$on("$stateChangeStart",function(t,o,n,r,s,i){conversationUserRef=new Firebase("https://mustknow.firebaseIO.com/conversationOnline/"+e.userDetails._id),conversationUserRef.remove()}),e.messageIsMine=function(t){return e.userDetails._id===t},e.getBubbleClass=function(t){var o="from-them";return e.messageIsMine(t)&&(o="from-me"),o},e.goToUserProfile=function(){l.SetUserProfile(e.chatDetails),s.go("app.userProfile",{userId:d})},e.sendMessage=function(t){f=new Date,e.dateString=f.toLocaleDateString(),c.sendMessage(t,e.chatDetails),e.data.message=""},t.fromTemplateUrl("templates/shared/drop-down-menu.html",{scope:e}).then(function(t){e.popover=t})}]),appControllers.controller("OnlineUserCtrl",["$scope","$firebaseObject","ConfigurationService","EntityService",function(e,t,o,n){var r=o.UserDetails(),s=n.getMessageDetails(),i=s.conversationId,a=i.split("-")[0],c=new Firebase("https://mustknow.firebaseIO.com/presence/"+a),l="https://mustknow.firebaseIO.com/chats/"+a+"/blocked/"+r._id,u=new Firebase(l),f=t(u);f.$loaded(function(t){t.userId?e.isUserOnline=!1:c.on("value",function(t){t.val()&&"online"==t.val()?e.isUserOnline=!0:e.isUserOnline=!1})})}])}(),function(){appControllers.controller("friendsCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","$firebaseArray","ConfigurationService","MessagesService","UserService","EntityService","$ionicPlatform","$cordovaContacts","$cordovaSms","toastr",function(e,t,o,n,r,s,i,a,c,l,u,f,d,m){e.friends=[],e.contactObject={},e.pop=function(){m.success("sent","Dal7e! ",{closeButton:!0,timeOut:100})},window.cordova&&"undefined"!=typeof window.plugins.OneSignal&&!i.Notification_token()&&r(function(){window.plugins.OneSignal.getIds(function(e){c.RegisterNotification(e.userId).then(function(e){i.SetNotification_token(e)},function(e){})})},10),c.GetFriends().then(function(t){i.getContactObject().then(function(t){e.contactObject=t},function(){}),e.friends=t},function(e){}),e.invite=function(){o.go("invite")},e.sendDahle=function(t){c.Invite({users:[{phone_number:t.phone_number,nickname:t.nickname}]}).then(function(){e.pop(),c.GetFriends().then(function(t){e.friends=t},function(e){})},function(e){})}}])}(),function(){appControllers.controller("inviteCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","$firebaseArray","ConfigurationService","MessagesService","UserService","EntityService","$cordovaContacts","$cordovaSms",function(e,t,o,n,r,s,i,a,c,l,u,f){i.getContactList().then(function(t){e.contacts=t},function(e){});var d={};e.selectContact=function(e){d[e.phoneNumber]?delete d[e.phoneNumber]:d[e.phoneNumber]=e},e.sms={};var m={replaceLineBreaks:!1,android:{intent:"INTENT"}};e.sendSms=function(){f.send(e.sms.number,e.sms.message,m).then(function(){console.log("Success")},function(e){console.log(e)})},e.selectThisPerson=function(e){e.isSelected=!e.isSelected},e.selectPerson=function(){if(window.cordova)u.pickContact().then(function(t){e.selectedPerson=t});else{var t={displayName:"obaida abo elhija",name:{familyName:"abo elhija",givenName:"obaida"},phoneNumbers:[{id:"1234",value:"052-886-9555"}]};e.selectedPerson=t}},e.sendBtn=function(){var t=[],n=[];for(var r in d)t.push(r),n.push({phone_number:d[r].phoneNumber,nickname:d[r].name});c.Invite({users:n}).then(function(){e.sms.number=t,e.sms.message="da7le !!",window.cordova&&e.sendSms(),o.go("friends")},function(e){})}}])}(),function(){appControllers.controller("loginCtrl",["$scope","$state","UserService","ConfigurationService",function(e,t,o,n){e.auth={},e.validPhone=!1,e.validSms=!1,e.title_arabic="??????",e.NotSendYet=!0,e.send=function(){if(0==e.validPhone&&e.auth.phoneNumber&&10==e.auth.phoneNumber.length&&e.auth.phoneNumber.indexOf("05")>=0)o.AuthPhone(e.auth.phoneNumber).then(function(t){NotSendYet=!1,window.localStorage.user=angular.toJson(t),e.validPhone=!0},function(e){});else if(1==e.validPhone&&0==e.validSms&&e.auth.smsCode&&e.auth.smsCode.length>0){n.userDetails=null;var r=n.UserDetails(),s={_id:r._id,activation_code:e.auth.smsCode};o.AuthConfirm(s).then(function(e){n.userDetails=null,window.localStorage.user=angular.toJson(e),t.go("friends")},function(e){})}},e.fbLogin=function(){if(console.log("fblogin"),window.cordova)o.FBlogin().then(function(e){window.localStorage.fbData=angular.toJson(e.authResponse);var r=e.authResponse,s=n.UserDetails(),i={_id:s._id,fbToken:r.accessToken};o.AuthFbLogin(i).then(function(e){console.log("create"),window.localStorage.user=angular.toJson(e);var o=new Firebase("https://mustknow.firebaseIO.com");o.authWithCustomToken(e.fireToken,function(e,o){e?console.log("Login Failed!",e):(console.log("subjects"),t.go("friends"))}),t.go("friends")},function(e){alert("error")})},function(e){console.log("Error while performing Facebook login",e)});else{var e=n.UserDetails(),r={_id:e._id,fbToken:"EAAZAMbMtmoBIBADZC9D2PExZC9BErm1rAialUc1hZAiZAXK8MNDyocR4dw6nHueHnQ9MCulaJiRl1uJP9ZBHpR6awynlab2Y2hiZBkmFNNiRzzZCG54SlOdH9L0LOoA5tp6j5OOAYYY3ty5aB5ZBy6mNVXZBANY4jhTP97rqOWXu0mZCCMOOX37yRdJUT20LfYOb31eeo1EKT9MByYJ4o9YcF60"};o.AuthFbLogin(r).then(function(e){console.log("create"),window.localStorage.user=angular.toJson(e);var o=new Firebase("https://mustknow.firebaseIO.com");o.authWithCustomToken(e.fireToken,function(e,o){e?console.log("Login Failed!",e):(console.log("subjects"),t.go("tab.subjects"))}),t.go("tab.subjects")},function(e){alert("error")})}}}])}(),function(){appControllers.controller("matchCtrl",["$scope","$cordovaContacts","MatchService",function(e,t,o){e.selectedPersons={},e.mainPerson={},e.otherPersons=[],e.selectPerson=function(o,n){if(window.cordova)t.pickContact().then(function(t){var r=t.displayName.split(" ");if(r.length>0){var s=r[0][0],i=r.length>=2?r[1][0]:"",a=s+i;t.fl=a}t.phoneNumbers[0].value=t.phoneNumbers[0].value.replace(/[\-]+/g,""),t.index=n,"mainPerson"==o&&(e.mainPerson={phone_number:t.phoneNumbers[0].value,contactName:t.displayName}),e.selectedPersons[o]=t});else{if("mainPerson"==o)var r={displayName:"obaida abo elhija",name:{familyName:"abo elhija",givenName:"obaida"},phoneNumbers:[{id:"1234",value:"052-886-9555"}]};else var r={displayName:"ahmed zedany",name:{familyName:"abo zedany",givenName:"ahmed"},phoneNumbers:[{id:"1234",value:"052-111-1111"}]};r.phoneNumbers[0].value=r.phoneNumbers[0].value.replace(/[\-]+/g,"");var s=r.displayName.split(" ");if(s.length>0){var i=s[0][0],a=s.length>=2?s[1][0]:"",c=i+a;r.fl=c}r.index=n,"mainPerson"==o&&(e.mainPerson={phone_number:r.phoneNumbers[0].value,contactName:r.displayName}),e.selectedPersons[o]=r}},e.match=function(){e.otherPersons=[],angular.forEach(e.selectedPersons,function(t,o){if(0!=t.index){var n={phone_number:t.phoneNumbers[0].value,contactName:t.displayName,index:t.index};e.otherPersons.push(n)}}),e.otherPersons.sort(function(e,t){return e.index-t.index});var t={mainPerson:e.mainPerson,otherPersons:e.otherPersons};o.Match(t).then(function(e){console.log(e),o.SendMessageToMatcher(e)},function(e){})}}]),appControllers.controller("subjectsCtrl",["$scope","$cordovaContacts","MessagesService","$ionicScrollDelegate","$ionicModal","$ionicPlatform","$rootScope","$state","$interval","$stateParams","$timeout","SubjectService","EntityService","UserService","MessagesService","ConfigurationService","backcallFactory",function(e,t,o,n,r,s,i,a,c,l,u,f,d,m,o,p,h){function v(t){f.GetSubjects(!1,e.scrollOptions).then(function(o){var n=[];angular.forEach(o.subjects,function(e){n.push(e)}),e.subjectsCount=o.count,t(n)},function(e){})}function g(){f.GetSubjects(!1,e.scrollOptions).then(function(t){e.subjects=t.subjects,e.subjectsCount=t.count},function(e){})}e.scrollOptions={skip:0,limit:20},e.loadOlderSubjects=function(){e.subjects.length>0&&(e.scrollOptions.skip=e.subjects.length,e.scrollOptions.limit=20),v(function(t){e.subjects=e.subjects.concat(t),e.$broadcast("scroll.infiniteScrollComplete")})},e.moreDataCanBeLoaded=function(){return!(e.subjects.length>=e.subjectsCount)},e.loadNewrSubjects=function(){e.scrollOptions={skip:0,limit:20},v(function(t){e.subjects=[],e.subjects=e.subjects.concat(t),e.$broadcast("scroll.refreshComplete")})},e.subjects=[],f.GetCategories().then(function(e){},function(e){}),s.ready(function(){if(h.backCall(),window.cordova&&"undefined"!=typeof window.plugins.OneSignal&&!p.Notification_token()&&u(function(){window.plugins.OneSignal.getIds(function(e){m.RegisterNotification(e.userId).then(function(e){p.SetNotification_token(e)},function(e){})})},5e3),e.userDetails=p.UserDetails(),e.userDetails){var t=new Firebase("https://mustknow.firebaseIO.com/.info/connected"),o=new Firebase("https://mustknow.firebaseIO.com/presence/"+e.userDetails._id),n=new Firebase("https://mustknow.firebaseIO.com/conversationOnline/"+e.userDetails._id);t.on("value",function(e){e.val()&&(o.onDisconnect().set("offline"),n.onDisconnect().remove(),o.set("online"))})}}),e.checkUndreadMessage=function(){return o.checkUndreadMessage()},e.goToChat=function(e){var t=e.user.first_name+" "+e.user.last_name,o={conversationId:e.user._id+"-"+e._id,userName:t,subjectName:e.title,fbPhotoUrl:e.user.fbPhotoUrl,desc:e.description};d.setMessageDetails(o),a.go("chat")},e.goToUserProfile=function(e){a.go("userProfile",{userId:e.user._id,first_name:e.user.first_name})},e.goToFilter=function(){},e.goToMessages=function(){a.go("tab.messages")},e.goToAddSubject=function(){a.go("addSubject")},r.fromTemplateUrl("templates/match/html/select-contact.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),e.$on("$destroy",function(){e.modal.remove(),console.log("$destroy")}),e.$on("modal.hidden",function(){console.log("modal hiden"),i.myFilter.categories=[],e.scrollOptions={skip:0,limit:20},f.GetCategories().then(function(t){e.categories=t,angular.forEach(e.categories,function(e,t){e.is_selected&&i.myFilter.categories.push(e._id)}),p.SetMyFilter(i.myFilter),g()},function(e){})}),e.$on("modal.removed",function(){console.log("removed")})}]),appControllers.controller("addSubjectCtrl",["$scope","$ionicLoading","$state","SubjectService","$stateParams","$filter","$ionicHistory","ConfigurationService","$ionicHistory",function(e,t,o,n,r,s,i,a,i){e.isExpanded=!0,e.failed=!1,e.subject={},
e.categories=[],e.initialForm=function(){e.subject={title:"",user:a.UserDetails()._id,description:""},n.GetCategories().then(function(t){e.categories=t},function(e){})},e.createSubjectSetp=function(e){o.go("tab.addSubject-s2",{categoryId:e._id})},e.createSubject=function(){return e.subject.description.length<=0?void(e.failed=!0):(e.subject.category=o.params.categoryId,t.show(),void n.CreateSubject(e.subject).then(function(){t.hide(),i.clearHistory(),o.go("tab.subjects")},function(e){t.hide()}))},e.initialForm()}])}(),function(){appControllers.controller("messagesCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","$firebaseArray","ConfigurationService","MessagesService","UserService","EntityService",function(e,t,o,n,r,s,i,a,c,l){e.$on("sendMessagesEvent",function(t,o){e.messages=a.getMessages(),e.$$phase||e.$apply()}),a.setMessages(),e.goToChat=function(e){var t={conversationId:e.conversationId,fbPhotoUrl:e.fbPhotoUrl,userName:e.userName,subjectName:e.subjectName,desc:e.desc};l.setMessageDetails(t),o.go("chat",{conversationId:e.conversationId})},e.goToUserProfile=function(e){c.SetUserProfile(e),o.go("userProfile")}}])}(),function(){appControllers.controller("myProfileCtrl",["$rootScope","$ionicModal","$ionicPopup","UserService","$firebaseArray","$ionicLoading","$scope","$state","$stateParams","$ionicHistory","EntityService","SubjectService","ConfigurationService",function(e,t,o,n,r,s,i,a,c,l,u,f,d){i.isActive=!1,i.activeButton=function(){i.isActive=!i.isActive},i.userProfile=d.UserDetails(),i.logOut=function(){n.LogOut().then(function(){window.localStorage.clear(),d.LogOut(),l.clearHistory(),a.go("login")},function(e){a.go("login")})},i.userProfile=d.UserDetails(),i.userDetails=d.UserDetails()}]),appControllers.controller("userProfileCtrl",["$rootScope","$scope","$state","$stateParams","EntityService","SubjectService","UserService",function(e,t,o,n,r,s,i){t.isExpanded=!0,e.isHeaderExpanded=!1,t.userProfile=i.GetUserProfile(),t.first_name=t.userProfile.first_name,t.a=function(){o.go("app.subjects")},t.isAnimated=n.isAnimated,t.subjects=[],s.GetMySubjects(t.userProfile.userId).then(function(e){t.subjects=e},function(e){}),t.goToSetting=function(){o.go("app.expenseSetting")}}]),appControllers.controller("profileSettingCtrl",["$scope","$state","$ionicHistory","$ionicViewSwitcher",function(e,t,o,n){e.navigateTo=function(e,r){o.currentStateName()!=e&&(o.nextViewOptions({disableAnimate:!1,disableBack:!0}),n.nextDirection("back"),t.go(e,{isAnimated:r}))}}])}();